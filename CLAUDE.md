# AIé–‹ç™ºã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ è¡Œå‹•æŒ‡ç¤º

## ğŸš¨ åŸºæœ¬åŸå‰‡ï¼ˆå¿…é ˆï¼‰
ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãƒ»ã‚³ãƒãƒ³ãƒ‰ãƒ»ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œå‰ã«å¿…ãšèª­ã¿è¾¼ã¿
- [åŸºæœ¬ãƒ«ãƒ¼ãƒ«](./instructions/base.md) - çµ¶å¯¾å³å®ˆäº‹é …
- [æ·±å±¤æ€è€ƒ](./instructions/deep-think.md)
- [memory](./instructions/memory.md)

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»ãƒ«ãƒ¼ãƒ«ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç´¢å¼•](./docs/README.md)

## ğŸ“‹ å ´é¢åˆ¥å¿…é ˆå‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«

### å®Ÿè¡Œç’°å¢ƒ
- [ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ](./instructions/command.md) - ã‚·ã‚§ãƒ«ã€å®Ÿè¡Œãƒ«ãƒ¼ãƒ«

### Gitãƒ»ã‚³ãƒŸãƒƒãƒˆé–¢é€£
- [Gitãƒ«ãƒ¼ãƒ«](./instructions/git.md) - GitHubæ“ä½œã€Issueã€ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥
- [ã‚³ãƒŸãƒƒãƒˆè¦ç´„](./instructions/commit-rules.md) - ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼
- [PRãƒ«ãƒ¼ãƒ«](./instructions/pr-rules.md) - ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆè¦ç´„

### é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹
- [é–‹ç™ºã‚¹ã‚¿ã‚¤ãƒ«](./instructions/develop.md) - Issueé§†å‹•ã€TDDã€ã‚¹ã‚¯ãƒ©ãƒ 
- [TDDãƒ«ãƒ¼ãƒ«](./instructions/KentBeck-tdd-rules.md) - ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º
- [ã‚¹ã‚¯ãƒ©ãƒ é–‹ç™º](./instructions/scrum.md) - ã‚¹ãƒ—ãƒªãƒ³ãƒˆç®¡ç†

### ç”¨èªãƒ»è¡¨è¨˜çµ±ä¸€
- [ãƒ‰ãƒ¡ã‚¤ãƒ³ç”¨èªé›†](./instructions/domain-terms.md) - çµ±ä¸€è¡¨è¨˜ç¢ºèª
- [ç”¨èªæ›´æ–°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼](./instructions/domain-term-workflow.md) - æ–°ç”¨èªææ¡ˆ

### èª¿æŸ»ãƒ»æ¤œç´¢
- [æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³é›†](./instructions/search-patterns.md) - Gitæ¤œç´¢ã‚³ãƒãƒ³ãƒ‰
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](./instructions/troubleshooting.md) - å•é¡Œè§£æ±ºæ‰‹é †

### è¨˜éŒ²ãƒ»ç®¡ç†
- [ãƒãƒ¼ãƒˆãƒ»æ—¥èªŒ](./instructions/note.md) - ä½œæ¥­è¨˜éŒ²ã®æ›¸ãæ–¹

## ğŸ”„ å®Ÿè¡Œãƒ•ãƒ­ãƒ¼
1. åŸºæœ¬ãƒ«ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ â†’ çµ¶å¯¾å³å®ˆäº‹é …ã®ç¢ºèª
2. å ´é¢ã«å¿œã˜ãŸå°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ â†’ å…·ä½“çš„ãªå®Ÿè¡Œãƒ«ãƒ¼ãƒ«ç¢ºèª
  - ä¾‹ï¼šå®Ÿè£…æ™‚ â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç´¢å¼• ã‚’å‚ç…§
3. å‚ç…§ç¢ºèªã®æ˜ç¤º â†’ `âœ…ï¸:{filename.md}` ã§è¡¨ç¤º
4. å®Ÿè¡Œ â†’ ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ä½œæ¥­å®Ÿè¡Œ

# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Google Fit to Notion Integration system that automatically syncs health/fitness data from Google Fit, weather data from Google Maps Platform Weather API, and GitHub activity data (closed issues and merged PRs) to a Notion database. The system runs on Google Cloud Platform using Cloud Functions/Run and Firestore for credential storage.

## Key Commands

### Development Setup
```bash
# Create virtual environment and install dependencies
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt

# Set up environment variables
cp .env.example .env
# Edit .env with your credentials

# Authenticate with Google and save credentials to Firestore
python scripts/utils/auth.py
```

### Deployment
```bash
# Deploy to Google Cloud Functions
./scripts/utils/deploy.sh
```

### Manual Triggers
```bash
# Trigger Google Fit data sync for a specific date (or today if no date provided)
./scripts/utils/trigger_fit.sh [YYYY-MM-DD]

# Update weather data for a specific date (or 2 days ago if no date provided)
./scripts/utils/update_weather.sh [YYYY-MM-DD]

# Update GitHub activity data for a specific date (or yesterday if no date provided)
./scripts/utils/update_github.sh [YYYYMMDD]

# Batch process multiple days (supports --fit-only, --weather-only, --github-only options)
bash src/batch_process.sh 2025-04-01 2025-04-10

# Automated daily execution via GitHub Actions
# Runs daily at JST 24:30, processing previous day's GitHub activity
```

## Architecture

### Core Components
- **src/main.py**: Main Cloud Function handler for Google Fit data sync
- **src/util.py**: Utilities for Google Fit API and Notion API interactions
- **src/weather/weather_notion.py**: Weather data retrieval and Notion update
- **src/weather/update_weather.py**: Standalone weather data fetcher
- **src/github/github_notion.py**: GitHub activity data sync to Notion
- **scripts/utils/auth.py**: Google OAuth authentication and Firestore credential storage

### Data Flow
1. Cloud Scheduler triggers PubSub topic
2. Cloud Function fetches data from Google Fit API
3. Weather data is fetched from Google Maps Weather API
4. GitHub activity data is fetched from GitHub API
5. Data is formatted and saved to Notion database
6. Credentials are managed via Firestore

### External Dependencies
- Google Fit API for health data
- Google Maps Platform Weather API for weather data
- GitHub API for activity data (issues and pull requests)
- Notion API for database updates
- Google Cloud Firestore for credential storage
- Google Cloud Functions/Run for serverless execution

## Important Considerations

### Notion Database Properties
The Notion database must have these exact property names (including units):
- æ—¥ä»˜ (Date type)
- ç§»å‹•è·é›¢ (km) (Number)
- æ­©æ•° (æ­©) (Number)
- æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ (kcal) (Number)
- å¼·ã‚ã®é‹å‹• (åˆ†) (Number)
- å¹³å‡å¿ƒæ‹æ•° (bpm) (Number)
- é…¸ç´ é£½å’Œåº¦ (%) (Number)
- ä½“é‡ (kg) (Number)
- ç¡çœ æ™‚é–“ (åˆ†) (Number)
- å¤©æ°— (Text)
- æ°—æ¸© (Text)
- æ¹¿åº¦ (Text)
- é™æ°´é‡ (Text)
- æ°—åœ§ (Text)
- æ—¥ç…§æ™‚é–“ (Text)
- Github (Text)
- æŒ¯ã‚Šè¿”ã‚Š (Checkbox)

### Environment Variables
Required in `.env`:
- `GCP_PROJECT`: Google Cloud project ID
- `NOTION_SECRET`: Notion API secret token
- `DATABASE_ID`: Notion database ID
- `MAPS_API_KEY`: Google Maps API key
- `LOCATION_LAT`: Latitude for weather data
- `LOCATION_LNG`: Longitude for weather data
- `GITHUB_TOKEN`: GitHub Personal Access Token (repo scope required for manual execution, auto-provided in GitHub Actions)

### Python Version
The project uses Python 3.9 as specified in the Dockerfile and Cloud Functions runtime.

### Security Notes
- Never commit `.env` file or credentials
- Use Firestore for secure credential storage
- Rotate credentials every 3 months using `scripts/utils/rotate_credentials.py`
- Audit credentials using `scripts/utils/audit_credentials.py`
